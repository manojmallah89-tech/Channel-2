<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Star Sports 1 HD</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
background: #000;
height: 100vh;
width: 100vw;
overflow: hidden;
font-family: system-ui, -apple-system, sans-serif;
}
.shaka-video-container {
position: absolute;
inset: 0;
width: 100%;
height: 100%;
}
video {
width: 100%;
height: 100%;
background: #000;
object-fit: contain;
}
.shaka-spinner-container,
.shaka-spinner,
.shaka-spinner-svg {
display: none !important;
visibility: hidden !important;
opacity: 0 !important;
}
</style>
</head>
<body>
<div class="shaka-video-container" data-shaka-player>
<video autoplay playsinline preload="metadata" poster=""></video>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
shaka.polyfill.installAll();

if (!shaka.Player.isBrowserSupported()) {
console.error('Browser not supported');
return;
}

const video = document.querySelector('video');
const player = new shaka.Player();
await player.attach(video);

const container = document.querySelector('.shaka-video-container');
const ui = new shaka.ui.Overlay(player, container, video);

ui.configure({
controlPanelElements: [
'play_pause', 'time_and_duration', 'mute', 'volume',
'spacer', 'language', 'captions', 'picture_in_picture',
'quality', 'fullscreen'
],
volumeBarColors: {
base: 'purple',
level: 'purple'
},
seekBarColors: {
base: 'gold',
buffered: 'gold',
played: 'gold'
}
});

// नई DRM कुकीज़ (ClearKey) यहाँ रिप्लेस की गई हैं
let drmConfig = {
clearKeys: {
"965dc2ddb1d85138ad787999a7f30ca5": "859695076e67fe961836b564db6d689c"
}
};

// नई कुकी हेडर
let cookieHeader = "__hdnea__=st=1771313762~exp=1771400162~acl=/*~hmac=55f2c8c60af3873042385ec7be2f3b769929e6aab945d6b593b4090149d7db4d";
// नई स्ट्रीम URL
let streamUrl = "https://jiotvmblive.cdn.jio.com/bpk-tv/Star_Sports_HD1_BTS/output/index.mpd";

player.configure({
drm: drmConfig,
streaming: {
lowLatencyMode: true,
bufferingGoal: 15,
rebufferingGoal: 2,
bufferBehind: 15,
retryParameters: {
timeout: 10000,
maxAttempts: 5,
baseDelay: 300,
backoffFactor: 1.2
},
segmentRequestTimeout: 8000,
segmentPrefetchLimit: 2,
useNativeHlsOnSafari: true
},
manifest: {
retryParameters: {
timeout: 8000,
maxAttempts: 3
}
}
});

player.getNetworkingEngine().registerRequestFilter((type, request) => {
request.headers['Referer'] = 'https://jiotv.com/';
request.headers['Origin'] = 'https://jiotv.com/';
request.headers['User-Agent'] = "plaYtv/7.1.3 (Linux;Android 13) ygx/824.1 ExoPlayerLib/824.0";
request.headers['Cookie'] = cookieHeader;

if (
(type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
type === shaka.net.NetworkingEngine.RequestType.SEGMENT) &&
request.uris[0] && !request.uris[0].includes('__hdnea=')
) {
const separator = request.uris[0].includes('?') ? '&' : '?';
request.uris[0] += separator + cookieHeader;
}
});

const enableAutoplay = () => {
video.setAttribute('autoplay', '');
video.setAttribute('playsinline', '');
video.autoplay = true;
};

const attemptAutoplay = async () => {
try {
video.muted = false;
await video.play();
return true;
} catch (error) {
try {
video.muted = true;
await video.play();
return true;
} catch (mutedError) {
return false;
}
}
};

player.addEventListener('error', (event) => {
console.error('Shaka Player Error:', event.detail);
});

video.addEventListener('play', () => {
if (window.self === window.top && !document.fullscreenElement && window.innerWidth <= 768) {
container.requestFullscreen().catch(() => {});
}
}, { once: true });

video.addEventListener('loadedmetadata', () => {
video.volume = 0.8;
});

let hasUserInteracted = false;
const enableSoundOnInteraction = () => {
if (!hasUserInteracted && video.muted) {
video.muted = false;
hasUserInteracted = true;
}
};
['click', 'touchstart', 'keydown'].forEach(event => {
document.addEventListener(event, enableSoundOnInteraction, { once: true });
});

try {
enableAutoplay();
await player.load(streamUrl);
if (video.readyState >= 3) {
await attemptAutoplay();
} else {
video.addEventListener('canplay', attemptAutoplay, { once: true });
setTimeout(async () => {
if (video.paused) {
await attemptAutoplay();
}
}, 2000);
}
} catch (error) {
console.error('Load error:', error);
}

document.addEventListener('visibilitychange', () => {
if (!document.hidden && video.paused) {
attemptAutoplay();
}
});
});
</script>
</body>
</html>
